---
title: "Data_Cleaning"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```


```{r}
library(dplyr)
library(tidyr)
library(zoo)
```



```{r}
#grad_rate = read.csv("graduation_rate.csv") #a lot of missing data
employ_rate = read.csv("employment_rate.csv")
wage_gap = read.csv("Gender_wage_gap.csv")
```

```{r}
employ_rate <-
  employ_rate %>%
  filter(!grepl('-', TIME)) %>%
  filter(grepl('PC_WKGPOP', MEASURE)) %>%
  filter(LOCATION != "OECD", LOCATION != "EU28", LOCATION != "G-7",  LOCATION != "EA19")
employ_rate$TIME <- as.numeric(as.character(employ_rate$TIME))

employ_rate <-
  employ_rate %>%
  spread(SUBJECT, Value) %>%
  mutate(genderDiff = (1-(WOMEN/MEN))*100) %>%
  select(LOCATION, TIME, genderDiff) %>%
  left_join(country_codes, by = c("LOCATION" = "CODE"))

  
   # filter(TIME >= 2005)
#employ_rate$TIME <- as.factor(employ_rate$TIME)

```


```{r}

write.csv(employ_rate, "employ_rate_final.csv")
```

```{r}

wage_gap$TIME <- as.numeric(as.character(wage_gap$TIME))
wage_gap <-
  wage_gap %>%
  filter(SUBJECT == 'TOT') %>%
  filter(LOCATION != 'EU28')

#wage_gap$TIME <- as.factor(wage_gap$TIME)
#write.csv( wage_gap,"wagegap_only.csv")
```

```{r}
all_tables <- rbind(employ_rate, wage_gap) #,grad_rate)
colnames(all_tables)[1] <- "LOCATION"
write.csv(all_tables, "final_table.csv")

```

```{r}
#To get info for a single county. Change the string inside grepl for for the
# country abreviation to get the data for a particular country
single_country <- 
  all_tables %>%
  filter(grepl('CAN', LOCATION))

write.csv( single_country,"canada_only.csv")

```

```{r}

country_codes <- read.csv("FinalProjectD3/src/data/country_codes.csv")
   
 

```

```{r}

country_codes <- 
  country_codes %>%
  select('CODE', 'Country')
   

```

```{r}

wage_gap <- 
  wage_gap %>%
  left_join(country_codes, by = c("LOCATION" = "CODE"))
   

```

```{r}
write.csv( wage_gap,"wagegap_only.csv")
```

```{r}
joint_data2 <-
  wage_gap %>%
  full_join(employ_rate) %>%
  arrange(LOCATION, TIME)
```


```{r}
write.csv(joint_data2, "employ_wage_data2.csv")
```

```{r}
emp_rat = which(is.na(joint_data2$genderDiff))
joint_data2$genderDiff[emp_rat] <- sapply(emp_rat, function(i) with(joint_data2, mean(c(genderDiff[i-1], genderDiff[i+1]))) )
```

```{r}
emp_rat = which(is.na(joint_data2$genderDiff))
joint_data2$genderDiff[emp_rat] = na.approx(joint_data2$genderDiff)

```
```{r}
write.csv(joint_data2, "employ_wage_data2.csv")
```
